// Mapping content sets to midi notes
// Exchange this file to change the preset
// or add preset logic here
const cloud9 = {
  id: 'cloud9',
  name: 'cloud9',
  contents: [
    { note: 48, media: { type: 'onomatopoeia', text: 'hmmm' } },
    { note: 49, media: { type: 'onomatopoeia', text: 'mmm' } },
    { note: 50, media: { type: 'onomatopoeia', text: 'mmoo' } },
    { note: 51, media: { type: 'onomatopoeia', text: 'ssss' } },
    {
      note: 52,
      media: {
        type: 'onomatopoeia',
        text: 'rrrrrrrrrrrrrRRRRRRRRRRRRRRRRrrrrrrrrrrrrrrr',
      },
    },
    {
      note: 53,
      media: {
        type: 'onomatopoeia',
        text: 'nyeeeeeeeaaaarrrrRRRRRRRRRRrrrrrummmm',
      },
    },
    { note: 54, media: { type: 'onomatopoeia', text: 'WHIRRRRRR' } },
    { note: 55, media: { type: 'onomatopoeia', text: 'ssshh' } },
    { note: 56, media: { type: 'onomatopoeia', text: 'WHIRRRRRR' } },
    { note: 57, media: { type: 'onomatopoeia', text: 'ssshh' } },
    { note: 58, media: { type: 'onomatopoeia', text: 'WHIRRRRRR' } },
    { note: 59, media: { type: 'onomatopoeia', text: 'ssshh' } },
    { note: 60, media: { type: 'onomatopoeia', text: 'pew' } },
    { note: 61, media: { type: 'onomatopoeia', text: 'zzztt' } },
    { note: 62, media: { type: 'onomatopoeia', text: 'brrr' } },
    { note: 63, media: { type: 'onomatopoeia', text: 'pew pew' } },
    { note: 64, media: { type: 'onomatopoeia', text: 'zzztt zzztt' } },
    {
      note: 65,
      media: {
        type: 'score',
        text: 'Long and intense',
        url: 'scores/cloud9-roar-soprano.musicxml',
      },
    },
    {
      note: 66,
      media: {
        type: 'score',
        text: `Fuwa fuwa
Light and fluffy. Also used to describe this kind of object floating through the air.
青空に白い雲がふわふわ浮いている。
Aozora ni shiroi kumo ga fuwa fuwa uiteiru.
White, fluffy clouds are floating in the blue sky.`,
        url: 'scores/cloud9-fuwa-fuwa-soprano.musicxml',
      },
    },
    {
      note: 67,
      media: {
        type: 'score',
        text: 'burst of energy, with all your lungs',
        url: 'scores/cloud9-kamehameha-soprano.musicxml',
      },
    },
    { note: 68, media: { type: 'onomatopoeia', text: 'zzztt zzztt' } },
    { note: 69, media: { type: 'onomatopoeia', text: 'zzztt zzztt' } },
    { note: 70, media: { type: 'onomatopoeia', text: 'zzztt zzztt' } },
    { note: 71, media: { type: 'onomatopoeia', text: 'zzztt zzztt' } },
    { note: 72, media: { type: 'onomatopoeia', text: 'swish' } },
    { note: 73, media: { type: 'onomatopoeia', text: 'swosh' } },
    { note: 74, media: { type: 'image', url: 'images/aladin-sheep.webp' } },
    { note: 75, media: { type: 'onomatopoeia', text: 'whoosh' } },
    { note: 76, media: { type: 'onomatopoeia', text: 'moan' } },
    { note: 77, media: { type: 'onomatopoeia', text: 'moan' } },
    { note: 78, media: { type: 'onomatopoeia', text: 'woaahhh (ghost)' } },
    { note: 79, media: { type: 'onomatopoeia', text: 'snap' } },
    { note: 80, media: { type: 'onomatopoeia', text: 'buhuuu' } },
    { note: 81, media: { type: 'onomatopoeia', text: 'moan' } },
    { note: 82, media: { type: 'onomatopoeia', text: 'throb' } },
    { note: 83, media: { type: 'onomatopoeia', text: 'twang' } },
    { note: 84, media: { type: 'onomatopoeia', text: 'twang' } },
    { note: 85, media: { type: 'onomatopoeia', text: 'twang' } },
    { note: 86, media: { type: 'onomatopoeia', text: 'plunk' } },
    { note: 87, media: { type: 'onomatopoeia', text: 'ding' } },
    { note: 88, media: { type: 'onomatopoeia', text: 'kawang' } },
    { note: 89, media: { type: 'onomatopoeia', text: 'drummmm' } },
    { note: 90, media: { type: 'onomatopoeia', text: 'twing' } },
    { note: 91, media: { type: 'onomatopoeia', text: 'drummmm' } },
    { note: 92, media: { type: 'onomatopoeia', text: 'drummmm' } },
    { note: 93, media: { type: 'onomatopoeia', text: 'crash' } },
    { note: 94, media: { type: 'onomatopoeia', text: 'drummmm' } },
    { note: 95, media: { type: 'onomatopoeia', text: 'krwall' } },
    { note: 96, media: { type: 'onomatopoeia', text: 'tap tap tap tap' } },
    { note: 97, media: { type: 'onomatopoeia', text: 'tink tink tink' } },
    { note: 98, media: { type: 'onomatopoeia', text: 'thisshigrrrerrk' } },
    { note: 99, media: { type: 'onomatopoeia', text: 'eeeoooeeeooo' } },
    { note: 100, media: { type: 'onomatopoeia', text: 'woo-woo-woo' } },
    { note: 101, media: { type: 'image', url: 'images/aladin-sheep.webp' } },
    { note: 102, media: { type: 'onomatopoeia', text: 'ding dong!' } },
    { note: 103, media: { type: 'onomatopoeia', text: 'tinge tinge dong!' } },
    { note: 104, media: { type: 'onomatopoeia', text: 'buhhh!' } },
    { note: 105, media: { type: 'onomatopoeia', text: 'wurg' } },
    { note: 106, media: { type: 'onomatopoeia', text: 'ahhh' } },
    { note: 107, media: { type: 'onomatopoeia', text: 'ohhh' } },
    { note: 108, media: { type: 'onomatopoeia', text: 'maaaaaeeeeh' } },
  ],
};

const standard = {
  id: 'default',
  name: 'Default',
  contents: [
    {
      note: 1,
      media: {
        type: 'onomatopoeia',
        text: 'You may add whatever content you want!',
      },
    },
  ],
};

const factoryPresets = [cloud9, standard];

const Presets = function (loadLocalStorage) {
  console.log('init Preset Factory');
  const presetsKey = 'presets';
  let selectedPreset;
  let presets = [];

  function getAll() {
    return presets;
  }

  function selectPreset(id) {
    if (id) {
      const preset = presets.find((p) => p.id === id);
      if (preset) selectedPreset = preset;
      else {
        console.error('preset with id' + id + 'not found');
      }
    } else {
      selectedPreset = presets[0];
    }
  }

  function savePresetsToLocal() {
    localStorage.setItem(presetsKey, JSON.stringify(presets));
    console.log('Presets saved to localStorage:', presets);
  }

  function loadPresetsFromLocal() {
    const storedPresets = localStorage.getItem(presetsKey);
    if (storedPresets) {
      presets = JSON.parse(storedPresets);
      console.log('Presets loaded from localStorage:', presets);
    } else {
      console.log('No presets found in localStorage. Loading factory preset');
      presets = factoryPresets;
    }
  }

  function getContent(note) {
    return selectedPreset.contents.find((c) => c.note === note);
  }

  function addContent(content) {
    console.log(content);

    // Check if a content with the same note already exists
    const existingContentIndex = selectedPreset.contents.findIndex(
      (c) => c.note === content.note,
    );
    console.log(existingContentIndex);

    // Create a new contents array with the updated content
    const newContents =
      existingContentIndex !== -1
        ? [
            ...selectedPreset.contents.slice(0, existingContentIndex),
            content,
            ...selectedPreset.contents.slice(existingContentIndex + 1),
          ]
        : [...selectedPreset.contents, content];

    // Update the selectedPreset with the new contents array
    selectedPreset = { ...selectedPreset, contents: newContents };

    console.log('Updated preset:', selectedPreset);
  }

  if (loadLocalStorage) loadPresetsFromLocal();

  selectPreset();

  return {
    getSelected: () => selectedPreset,
    setName: (name) => (selectPreset.name = name),
    setId: (id) => (selectPreset.id = id),
    getSelectedJSON: () => JSON.stringify(selectedPreset, null, 2),
    getContents: () => selectedPreset.contents,
    getContent: (note) => getContent(note),
    addContent: (content) => addContent(content),
    selectPreset: function (id) {
      selectPreset(id);
    },
    preload: function () {
      preload(selectedPreset.contents);
    },
    savePresetsToLocal,
    loadPresetsFromLocal,
    getAll,
  };
};
